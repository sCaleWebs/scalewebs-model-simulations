[
  {
    "path": "posts/2022-04-13-beta-diversity-and-species-responses/",
    "title": "Beta diversity and species responses",
    "description": "A short description of the post.",
    "author": [
      {
        "name": "Andrew MacDonald",
        "url": "https://example.com/norajones"
      }
    ],
    "date": "2022-04-13",
    "categories": [],
    "contents": "\n\n\nlibrary(tidyverse)\n\n\n\nFood web simulations\nNeed to simulate the food web in a plausible way. Some constraints:\nAll species except basal resources need a link\nmost species will have only 3 connections (ie they eat basal resources)\nfinally, we want to relate a species number of links to the community.\nNumber of links per consumer is :\n\\[\nL_i = (S - 1)p_i + 1\n\\]\npossibly with the constraint that the one link canâ€™t be a cannibal!\nThe probability of a link, \\(p_i\\) is another way of thinking about the degree of a species\nIn our dataset the modal species richness is 3 because most species are detritivores that eat all the basal resources\n\nDo we want to have some kind of.. 3-inflated distribution for our links?\nOne simple way to do this is to allow the node distribution to have an average centered on 3\nThe steps: * find the average p for a food web where most species eat 3 things * let each consumer have a different p (complexify this later) * draw links for each predator\n\n\nn_basal <- 3\nS <- 12\n\nmean_p <- (n_basal - 1)/(S - 1)\n\nconsumer_probs <- rbeta(n = S - n_basal, mean_p * 3, (1 - mean_p) * 3)\n\nconsumer_links <- rbinom(S - n_basal, S - 1, prob = consumer_probs) + 1\n\nhist(consumer_links)\n\n\n\n\nthis could be converted to the logit scale:\n\n\nconsumer_probs_logit <- plogis(qlogis(mean_p) + rnorm(S - n_basal, mean = 0, sd = .2))\n\ndegrees <- rbinom(S - n_basal, S - 1, prob = consumer_probs_logit) + 1\n\ntibble(degrees) |> \n  count(degrees) |> \n  ggplot(aes(x = degrees, y = n)) + \n  geom_bar(stat = \"identity\") + \n  coord_cartesian(xlim = c(0, S))\n\n\n\n\nsimulate incidence functions\n\\[\n\\begin{align}\nY_i &\\sim \\text{Binomial}(p, 1) \\\\\n\\text{logit}(p) &= a(\\phi - b) \\\\\n\\phi &= \\bar{\\phi} + \\beta_{e}X_e \\\\\n\\begin{bmatrix} a \\cr b\\ \\end{bmatrix} &\\sim \\text{MVN}(\\begin{bmatrix} \\bar{a} \\cr \\bar{b}\\ \\end{bmatrix}, \\Sigma)\n\\end{align}\n\\]\n\n\nnsites <- 45\nx <- runif(nsites, min = -3, max = 3)\n\nbar_phi <- -1\nbeta_phi <- .3\n\nphi <- bar_phi + beta_phi * x\n\nplot(x, plogis(phi))\n\n\n\n\nsimulate correlated \\(a\\) and \\(b\\)\n\n\ncorr_mat <- matrix(c(1, .5, .5, 1), nrow = 2)\nsds <- c(.4, 1)\n\nsig <- diag(sds) %*% corr_mat %*% diag(sds)\n\nconsumer_a_b <- MASS::mvrnorm(S - n_basal, mu = c(1.5, -3), Sigma = sig)\n\n\n\nmatch species and sites to the coefs:\n\n\nfake_data <- expand_grid(site = 1:nsites, sp = 1:(S - n_basal)) |> \n  mutate(\n    x = x[site],\n    logit_prob = consumer_a_b[sp, 1] * (phi[site] - consumer_a_b[sp, 2]))\n\nfake_data |> \n  ggplot(aes(x = x, y = logit_prob, group = sp)) + \n  geom_line()\n\n\n\nfake_data |> \n  ggplot(aes(x = x, y = plogis(logit_prob), group = sp)) + \n  geom_line()\n\n\n\n\nNow, we need to sample species compositions from this curve\n\n\nfake_data_obs <- fake_data |> \n  mutate(prb = plogis(logit_prob),\n         presabs = rbinom(nrow(fake_data), size = 1, prob = prb))\n\nfake_data_obs |> \n  group_by(site, x) |> \n  summarize(richness = sum(presabs)) |> \n  ggplot(aes(x = x, y = richness)) + geom_point()\n\n\n\n\nFinally, we can tweak the simulation to include correlations between the response to the environment and the number of nodes\nCould then look at the relationship between connectance and the environment, for example\n\n\n\n",
    "preview": "posts/2022-04-13-beta-diversity-and-species-responses/beta-diversity-and-species-responses_files/figure-html5/unnamed-chunk-2-1.png",
    "last_modified": "2022-04-13T17:10:06-04:00",
    "input_file": "beta-diversity-and-species-responses.knit.md"
  }
]
